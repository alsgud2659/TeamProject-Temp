<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://kit.fontawesome.com/3e4acc40f3.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/assets/css/mypage_style.css">
    <link rel="stylesheet" href="/assets/css/MyPageHeader.css">
    <link rel="stylesheet" href="/assets/css/MyPageFooter.css"> <!--ì•„ì§ë¯¸êµ¬í˜„-->
    <title>íšŒì›ì •ë³´ìˆ˜ì •</title>

</head>

<body class="user-info-change-body">

<div id="my_modal2" class="my_modal2">
    <h1 class="modal-in">
        <div class="modal-in1">ì •ë§ Pick it upì„ ë– ë‚˜ì‹¤ ê±´ê°€ìš”?</div>
        <div class="modal-in2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                    viewBox="0 0 24 24">
            <path
                    d="M18.5 4L12 10.5 5.5 4 4 5.5l6.5 6.5L4 18.5 5.5 20l6.5-6.5 6.5 6.5 1.5-1.5-6.5-6.5L20 5.5 18.5 4z"
                    fill="#cacaca"></path>
        </svg></div>
    </h1>
    <form action="/user/delete" class="deleteUser">
        <div color="#666666" font-weight="bold" class="modal-in3">íšŒì›íƒˆí‡´ ì‹ ì²­ ì „ ì•„ë˜ ì‚¬í•­ì„
            í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤ ğŸ˜Š</div>
        <div color="#666666" class="modal-in3">1. ì‚­ì œí•˜ê¸° í´ë¦­í›„ ë°”ë¡œ íšŒì›íƒˆí‡´ê°€ ì²˜ë¦¬ë©ë‹ˆë‹¤.</div>
        <div color="#666666" class="modal-in3">2. íšŒì›íƒˆí‡´ í›„ ê¸°ì¡´ ê³„ì •ìœ¼ë¡œ íšŒì›ê°€ì…ì„ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        </div>
        <div color="#666666" class="modal-in3">3. ë°°ì†¡/êµí™˜/ë°˜í’ˆ ì¤‘ì¸ ìƒí’ˆì´ ìˆëŠ” ê²½ìš° ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        </div>
        <div color="#666666" class="modal-in3">4. íšŒì›íƒˆí‡´ ì‹œ íšŒì›ì´
            ê°€ì§„ í¬ì¸íŠ¸ ë° ê¶Œë¦¬ëŠ” ëª¨ë‘ ì†Œë©¸í•©ë‹ˆë‹¤. íšŒì›íƒˆí‡´ í›„ í¬ì¸íŠ¸ ì‚¬ìš©ì´ ë¶ˆê°€í•˜ë¯€ë¡œ í•„ìš”í•œ ê²½ìš° íƒˆí‡´ ì „ì— í™•ì¸í•´ì£¼ì„¸ìš”.</div>
        <div color="#666666" class="modal-in3">5. íšŒì›íƒˆí‡´ ì‹œ íšŒì‚¬ê°€ ë³´ê´€í•˜ê³  ìˆëŠ” íšŒì› ë°ì´í„°ëŠ” ëª¨ë‘
            ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ë‹¤ë§Œ, ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ íšŒì‚¬ê°€ ë³´ê´€í•  ì˜ë¬´ê°€ ìˆëŠ” ì •ë³´ ë˜ëŠ” ìë£ŒëŠ” ì¼ì •ê¸°ê°„ ë™ì•ˆ ë³´ê´€ë©ë‹ˆë‹¤.</div>
        <div color="#666666" class="modal-in3">6. íšŒì›íƒˆí‡´ í›„ Pick it upì— ê²Œì‹œí•œ ê²Œì‹œë¬¼ì„ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œí• 
            ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í•„ìš”í•œ ê²½ìš° ì‹ ì²­ ì „ ê²Œì‹œë¬¼ì„ í¸ì§‘í•˜ê±°ë‚˜ ì‚­ì œí•´ì£¼ì„¸ìš”.</div>

        <div class="modal-by6">
            <div font-weight="bold" class="modal-by7">ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ì–´ìš”?</div><button type="button"
                                                                                class="modal-by8" color="default"
                                                                                fill="true"><span class="modal-by9">Pick it up ê³„ì† ì‚¬ìš©í•˜ê¸°</span></button><button type="submit"
                                                                                                                                                              class="modal-by10" color="orange"
                                                                                                                                                              fill="true"><span class="modal-by11">ê³„ì • ì‚­ì œí•˜ê¸°</span></button>
        </div>
    </form>

    <a class="modal_close_btn2" id="modal_close_btn2">ë‹«ê¸°</a>
</div>
<div id="mypage-total-inside-user">
    <div id="mypage-wrap">
        <div class="myinfo-list">
            <div class="first-info-forms">
                <div class="top-bar">
                    <div class="top-bar2"><a target="_self" class="top-bar3" href="/user/myPage">ë§ˆì´í˜ì´ì§€</a></div>
                    <div class="title-divide"></div>
                    <div disabled="" class="top-bar-middle"><a target="_self" class="top-bar-middle2"
                                                               href="/me/edit">í”„ë¡œí•„ ìˆ˜ì •</a></div>
                </div>
                <div class="user-info-profile"><label class="sc-1d23226d-0 jeRPsg">
                    <input type="file" class="user-profile-change" name="uploadFile" accept="image/*">
                    <input type="hidden" name="profileFileName" value="">
                    <input type="hidden" name="profileUploadPath" value="">
                    <div size="88" class="info-change1">
                        <div size="88" class="info-change2"><span class="info-change3">
                                        <picture class="JCHSH => info-change4" id="profileImage">
<!--                                            <img sizes="100vw" src="https://class101.net/images/default-user.png">-->

                                        </picture>
                                    </span></div>
                        <div class="info-change5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                       fill="none" viewBox="0 0 24 24">
                            <path fill-rule="evenodd"
                                  d="M4 21a1 1 0 01-1-1v-4a1 1 0 01.293-.707l11-11a3.83 3.83 0 015.414 0 3.83 3.83 0 010 5.414l-11 11A1 1 0 018 21H4zm1-2h2.586l.707-.707-2.586-2.586-.707.707V19z"
                                  fill="#FFF"></path>
                        </svg></div>
                    </div>
                </label></div>
                <form method="post" action="/user/infoUpdate" id="modifyForm" th:object="${user}">
                    <div class="info-input1">
                        <div class="info-input2"><label class="info-input3 user_change" id="user_e_mail">ì´ë©”ì¼</label>
                            <div class="info-input4"><input class="info-input5" type="text" name="email"
                                                            th:value="*{email}" readonly></div>
                        </div>
                    </div>
                    <div class="info-input1">
                        <div class="info-input2">
                            <div class="labelBox">
                            <label class="info-input3 user_change" id="user_nickname">ë‹‰ë„¤ì„</label>
                            <span class="check-text" id="nicknameCheck_text"></span>
                            </div>
                            <div class="info-nickname address-info">
                                <div class="info-input6"><input class="info-nick" id="nickname" type="text" th:value="*{nickname}" name="nickname">
                                </div>
                                <button type="button" class="user-info-phone-change-btn" color="default" fill="false"><span class="user-info-ch1 nickCheck">í™•ì¸</span></button>
                            </div>
                        </div>
                    </div>
                    <div class="info-input1">
                        <div class="info-input2"><label class="info-input3" id="user_phone">íœ´ëŒ€í° ë²ˆí˜¸</label>
                            <div class="info-phone1 address-info">
                                <div class="info-input6"><input class="info-phone2" type="text" th:value="*{phone}" name="phone" readonly></div>
                                <button type="button" class="user-info-phone-change-btn " color="default" id="phoneChange"
                                        fill="false"><span class="user-info-ch1 phone-modi">ìˆ˜ì •</span></button>
                            </div>
                        </div>
                    </div>
                    <div class="info-input1">
                        <div class="info-input2"><label class="info-input3">ì£¼ì†Œ</label>
                            <div class="info-phone1 ">
                                <div class="info-input6"><input class="info-address input-data address-info"
                                                                type="text" id="state" th:value="*{address}" name="address"></div>
                                <button type="input" class="user-info-phone-change-btn"
                                        color="default"><span class="user-info-ch1 btnCertify">ê²€ìƒ‰</span></button>
                            </div>
                            <div class="adrr-second">
                                <input class="info-input5 input-data address2 state-detail" type="text"
                                       id="state-detail" th:value="*{addressDetail}" name="addressDetail">
                            </div>
                        </div>
                    </div>
                    <div class="modify-con"><button type="submit" class="modify-checking checking-modify"
                                                    id="modi-ok" color="orange" fill="true" disabled="true"><span
                            class="sc-89f01919-1 jwNHGa">ìˆ˜ì •í•˜ê¸°</span></button></div>

                    <div class="phone-modalBack">
                        <div class="phone-modalBox">
                            <div class="phone-modalTop">
                                <h3 class="phone-modalTitle">íœ´ëŒ€í° ì¸ì¦í•˜ê¸°</h3>
                                <button type="button" class="close-modal">
                                    <span class="closeArea">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path d="M18.5 4L12 10.5 5.5 4 4 5.5l6.5 6.5L4 18.5 5.5 20l6.5-6.5 6.5 6.5 1.5-1.5-6.5-6.5L20 5.5 18.5 4z" fill="#1a1a1a"></path></svg>
                                    </span>
                                </button>
                            </div>
                            <div class="phone-modalText">ì •ë³´ ìˆ˜ì •ì„ ìœ„í•´ ë³¸ì¸ì˜ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì¸ì¦í•´ ì£¼ì„¸ìš”.</div>
                            <div class="phone-modalMiddleBox">
                                <div class="phone-modalMiddle">
                                    <label class="phone-modalMiddleText">íœ´ëŒ€í° ë²ˆí˜¸</label>
                                    <div class="phone-modalMiddleNumBox">
                                        <input class="phone-modalMiddleNum" placeholder="-ì„ ì œì™¸í•œ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
                                        <button type="button" class="phone-modalSubmit1">
                                            <span class="phone-modalSubmitText">ì¸ì¦ ë²ˆí˜¸ ë°›ê¸°</span>
                                        </button>
                                    </div>
                                    <div class="phone-modalMiddleNumCheckBox">
                                        <input class="phone-modalMiddleNumCheck" placeholder="ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                        <button type="button" class="phone-modalSubmit2">
                                            <span class="phone-modalSubmitText">ì¸ì¦ ë²ˆí˜¸ í™•ì¸</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" th:value="*{profileFileName}" id="profileFileName" name="profileFileName">
                    <input type="hidden" th:value="*{profileUploadPath}" id="profileUploadPath" name="profileUploadPath">
                    <input type="hidden" th:value="*{point}" id="point" name="point">
                    <input type="hidden" th:value="*{category}" id="category" name="category">
                    <input type="hidden" th:value="*{num}" id="num" name="num">
            </form>
            <div class="bottom-line"></div>
            <div class="out-confirm-q">

                <div class="out-confirm-q2"><input type="button" class="out-confirm-b" color="default" value="íšŒì›íƒˆí‡´"
                                                   fill="true" onclick="document.getElementById('popup_open_btn2').click();">
                    <button id="popup_open_btn2">íŒì—…ì°½ ë„ì–´ ì¤˜ì—¼</button>

                </div>

            </div>

        </div>
    </div>
</div>
</div>
</body>
<script th:inline="javascript">
    let regex = new RegExp("(.*?)\.(exe|sh|zip|alz)");
    let fileName = [[${user.profileFileName}]];
    let uploadPath = [[${user.profileUploadPath}]];

    let str = "<img sizes='100vw' width='100px' src='/userFile/display?fileName=" + uploadPath + "/"  + fileName + "'>";
    $('#profileImage').html(str);

    $('.modal-by8').on("click", function () {
        $('.deleteUser').submit;
        alert("ì •ìƒì ìœ¼ë¡œ íƒˆí‡´ë˜ì—ˆìŠµë‹ˆë‹¤.");
    })

    function checkExtension(fileName, fileSize){
        if(regex.test(fileName)){
            alert("ì—…ë¡œë“œ í•  ìˆ˜ ì—†ëŠ” íŒŒì¼ì˜ í˜•ì‹ì…ë‹ˆë‹¤.");
            return false;
        }
        if(fileSize >= 5242880){
            alert("íŒŒì¼ ì‚¬ì´ì¦ˆ ì´ˆê³¼");
            return false;
        }
        return true;
    }

    $("input[type='file']").on("change",function () {

        let formData = new FormData();
        let inputFile = $("input[name='uploadFile']");
        let files = inputFile[0].files;
        console.log(files);
        for(let i=0; i<files.length; i++){
            if(!checkExtension(files[i].name, files[i].size)){ return; }
            formData.append("uploadFile", files[i]);
        }
        $.ajax({
            url: "/userFile/upload",
            type: "post",
            data: formData,
            contentType: false,
            processData: false,
            success: function(data){
                console.log(data);
                console.log(data.profileFileName);
                console.log(data.profileUploadPath);

                $('input[name=profileFileName]').val(data.profileFileName);
                $('input[name=profileUploadPath]').val(data.profileUploadPath);

            }
        });

    })
</script>
<script th:inline="javascript">
    let nicknamePass = false;
    let phonePass = false;
    let phoneCheckPass = false;
    let pwPass = false;
    let $upw = $('#uPassword');
    let $upw2 = $('#uPasswordCheck');

    $('.nickCheck').on("click", function () {
        let $unicknameval = $('#nickname').val();
        $.ajax({
            url: "/userR/nicknameMatching",
            type: "post",
            data: {nickname: $unicknameval},
            success: function (result) {
                if(result === 0) {
                    $('#nicknameCheck_text').empty().text("ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤.").css("color", "green");
                    nicknamePass = true;
                } else {
                    $('#nicknameCheck_text').empty().text("ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤.").css("color", "red");
                    nicknamePass = false;
                }
            }
        })
    })

    $('#phoneChange').on("click", function () {
        $('.phone-modalBack').css('display','flex');
    })

    $('.close-modal').on("click", function () {
        $('.phone-modalBack').css('display','none');
    })

    // ì¸ì¦ë²ˆí˜¸ ë³´ë‚´ê¸°
    $('.phone-modalSubmit1').click(function () {
        $('.phone-modalMiddleNumCheckBox').css('display','flex');
        let phoneNumber = $('.phone-modalMiddleNum').val();
        alert('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì™„ë£Œ!');
        $.ajax({
            type: "GET",
            url: "/sms/single",  // restControllerë¡œ ë³´ë‚¼ê²ƒ
            data: {
                "phoneNumber": phoneNumber
            },
            success: function (res) {
                $('.phone-modalSubmit2').on("click", function () {
                    if ($.trim(res) == $('.phone-modalMiddleNumCheck').val()) {
                        alert('ì¸ì¦ì„±ê³µ!');
                        phoneCheckPass = true;
                        $('.info-phone2').val(phoneNumber);
                        $('.phone-modalBack').css('display','none');
                    } else {
                        alert('ì¸ì¦ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤!');
                    }
                })
            }
        })
    });



    $('#modi-ok').on("click", function (e) {

        // } else if(!phoneCheckPass) {
        //     alert("ì „í™”ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”");
        //     return false;
        if(!nicknamePass) {
            alert("ë‹‰ë„¤ì„ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”");
            return false;
        }

        modifyForm.submit();

    })

</script>

<script>
    function modal(id) {
        var zIndex = 9999;
        var modal = document.getElementById(id);

        // ëª¨ë‹¬ div ë’¤ì— í¬ë„ë¬´ë ˆí•œ ë ˆì´ì–´
        var bg = document.createElement('div');
        bg.setStyle({
            position: 'fixed',
            zIndex: zIndex,
            left: '0px',
            top: '0px',
            width: '100%',
            height: '100%',
            overflow: 'auto',
            // ë ˆì´ì–´ ìƒ‰ê°ˆì€ ì—¬ê¸°ì„œ ë°”ê¾¸ë©´ ë¨
            backgroundColor: 'rgba(0,0,0,0.4)'
        });
        document.body.append(bg);

        // ë‹«ê¸° ë²„íŠ¼ ì²˜ë¦¬, ì‹œêº¼ë¨¼ ë ˆì´ì–´ì™€ ëª¨ë‹¬ div ì§€ìš°ê¸°
        modal.querySelector('.modal_close_btn2').addEventListener('click', function () {
            bg.remove();
            modal.style.display = 'none';
        });

        modal.querySelector('.modal-by8').addEventListener('click', function () {
            bg.remove();
            modal.style.display = 'none';
        });

        modal.setStyle({
            position: 'fixed',
            display: 'block',
            boxShadow: '0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)',

            // ì‹œêº¼ë¨¼ ë ˆì´ì–´ ë³´ë‹¤ í•œì¹¸ ìœ„ì— ë³´ì´ê¸°
            zIndex: zIndex + 1,

            // div center ì •ë ¬
            top: '50%',
            left: '50%',
            transform: 'translate(-50%, -50%)',
            msTransform: 'translate(-50%, -50%)',
            webkitTransform: 'translate(-50%, -50%)'
        });

        $(".modal-in2").on("click", function () {
            bg.remove();
            $("#my_modal2").attr("style", "display:none");
        });

    }

    // Element ì— style í•œë²ˆì— ì˜¤ë¸Œì íŠ¸ë¡œ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
    Element.prototype.setStyle = function (styles) {
        for (var k in styles) this.style[k] = styles[k];
        return this;
    };

    document.getElementById('popup_open_btn2').addEventListener('click', function () {
        // ëª¨ë‹¬ì°½ ë„ìš°ê¸°
        modal('my_modal2');
    });

    $('.btnCertify').on("click", function () {
        new daum.Postcode({
            oncomplete: function (data) {
                var addr = ''; //ì£¼ì†Œ ë³€ìˆ˜
                if(data.userSelectedType ==='R'){
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }

                // ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                document.getElementById("state").value = addr;
                $('.state-detail').focus();
            }
        }).open();
    });
</script>

<script>
    function getImageFiles(e) {
        const uploadFiles = [];
        const files = e.currentTarget.files;
        const imagePreview = document.querySelector('.info-change4');
        const docFrag = new DocumentFragment();

        // íŒŒì¼ íƒ€ì… ê²€ì‚¬
        [...files].forEach(file => {
            if (!file.type.match("image/.*")) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return
            }

            // íŒŒì¼ ê°¯ìˆ˜ ê²€ì‚¬
            if ([...files].length < 7) {
                uploadFiles.push(file);
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = createElement(e, file);
                    imagePreview.replaceChildren(preview);
                };
                reader.readAsDataURL(file);
            }
        });
    }

    function createElement(e, file) {
        const li = document.createElement('li');
        const img = document.createElement('img');
        img.setAttribute('src', e.target.result);
        img.setAttribute('data-file', file.name);
        li.appendChild(img);

        return li;
    }

    const realUpload = document.querySelector('.user-profile-change');
    const upload = document.querySelector('.info-change2');

    upload.addEventListener('click', () => realUpload.click());

    realUpload.addEventListener('change', getImageFiles);
</script>


<script>

    let ph1 = document.querySelector("#nickname");
    let mph1 = ph1.placeholder;

    let ph2 = document.querySelector("#state");
    let mph2 = ph2.placeholder;
    let ph3 = document.querySelector("#state-detail");
    let mph3 = ph3.placeholder;


    $(function(){
        $("#nickname").on('input', function(){
            if($("#nickname").val()=='' || $("#nickname").val()===mph1 || $("#nickname").val().trim() == ""){
                $("#modi-ok").attr("disabled", true);
            } else{
                $("#modi-ok").attr("disabled", false);
            }
        });
    })


    $(function(){
        $("#state-detail").on('input', function(){
            if($("#state").val() != ""){
                if($("#state-detail").val()==''){
                    $("#modi-ok").attr("disabled", true);
                } else{
                    $("#modi-ok").attr("disabled", false);
                }
            }
        });
    })


</script>




</body>
<script src="/static/assets/mypage.js"></script>

</html>